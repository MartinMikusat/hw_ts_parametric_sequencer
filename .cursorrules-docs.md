# Documentation Workflow Rules

This file defines the rules and guidelines for maintaining the documentation system for this project.

## Documentation Pipeline

The documentation follows this pipeline:

```
TSDoc comments in TypeScript source
        ↓
TypeDoc (with Markdown plugin)
        ↓
Generated Markdown files (API docs)
        ↓
Astro (Starlight) renders the Markdown
```

## General Rules

1. **Never attempt to parse TSDoc directly inside Astro.**  
   Astro cannot parse TSDoc. Always use TypeDoc to generate Markdown first.

2. **Always generate API documentation using TypeDoc before building the Astro site.**  
   Run `npm run docs:generate` before `npm run docs:build`.

3. **Ensure all public APIs have TSDoc comments.**  
   All exported classes, interfaces, types, and functions must have comprehensive TSDoc documentation.

4. **Prefer symlinking the TypeDoc output into Astro rather than copying.**  
   The symlink is set up at `docs/src/content/docs/api` → `../../../api` (for Starlight's autogenerate feature).

5. **Never modify generated Markdown manually.**  
   All API documentation is generated by TypeDoc. Only modify TSDoc comments in source files.

6. **Do not reinvent the documentation system**—follow this pipeline exactly.

## Directory Structure Rules

1. TypeScript code lives in `src/`.
2. API docs generated into `docs/api/` (via TypeDoc).
3. Astro site reads from `docs/src/content/docs/api` (symlinked to `../../../api`) for Starlight's autogenerate feature.
4. Astro pages and guide documents live in `docs/src/content/docs`.
5. TypeDoc configuration is in `typedoc.json` at the root.

## Build Process Rules

1. Running `typedoc` is required before `astro build`.
2. The build scripts are:
   - `npm run docs:generate` - Generate TypeDoc API docs
   - `npm run docs:dev` - Run Astro dev server
   - `npm run docs:build` - Generate TypeDoc + build Astro site
   - `npm run docs:preview` - Preview built Astro site
3. If building in CI, the steps must be:
   ```
   install → typedoc → astro build → deploy
   ```

## TSDoc Comment Standards

1. **All public APIs must have TSDoc comments** using the `/** */` format.
2. **Use @param for parameters**, @returns for return values, @remarks for additional notes.
3. **Include @example blocks** for complex APIs.
4. **Document all properties** of interfaces and types.
5. **Use @internal** for methods that are not part of the public API.

## TypeDoc Configuration

- Entry points: `src/2d/index.ts` and `src/3d/index.ts`
- Output: `docs/api`
- Plugin: `typedoc-plugin-markdown`
- Excludes: private, protected, and internal members

## Astro/Starlight Structure

- Configuration: `docs/astro.config.mjs`
- Content: `docs/src/content/docs/` (guides) and `docs/src/content/api/` (API docs)
- Public assets: `docs/public/`
- Build output: `docs/dist/`

## CI/CD

- GitHub Actions workflow: `.github/workflows/docs.yml`
- Automatically builds and deploys on push to `main` branch
- Deploys to GitHub Pages

## When Adding New APIs

1. Add comprehensive TSDoc comments to the new API.
2. Run `npm run docs:generate` to regenerate API docs.
3. Verify the docs appear correctly in `docs/src/content/api`.
4. Test locally with `npm run docs:dev`.
5. Commit both source code changes and generated API docs.

## When Modifying Documentation

1. For API documentation: Modify TSDoc comments in source files, then regenerate.
2. For guide pages: Edit Markdown files in `docs/src/content/docs/`.
3. Always test locally before committing.

## Common Issues

- **API docs not appearing**: Run `npm run docs:generate` first.
- **Symlink issues**: Ensure `docs/src/content/docs/api` is a symlink to `../../../api` (for CI builds, the workflow creates this automatically).
- **Build failures**: Check that TypeDoc runs successfully before Astro build.

